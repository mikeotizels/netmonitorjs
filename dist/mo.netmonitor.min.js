/*!
 * Mikeotizels Network Monitor JS v2.0.0
 * https://github.com/mikeotizels/netmonitorjs
 * Copyright 2025-2026 Michael Otieno
 * Licensed under MIT (http://opensource.org/licenses/MIT)
 */(()=>{"use strict";window.moNetworkMonitor=class{constructor(e={}){this.options=e;this.pingUrl=this.options.pingUrl||null;this.pollInterval=this.options.pollInterval||1e4;this.maxInterval=this.options.maxInterval||6e4;this.backoffFactor=this.options.backoffFactor||2;this.currentInterval=this.pollInterval;this.onCheck="function"==typeof this.options.onCheck?this.options.onCheck:()=>{};this.onOnline="function"==typeof this.options.onOnline?this.options.onOnline:()=>{};this.onOffline="function"==typeof this.options.onOffline?this.options.onOffline:()=>{};this.onChange="function"==typeof this.options.onChange?this.options.onChange:()=>{};this._lastStatus="online";this._lastEffectiveType=null;this._checkTimer=null;this._check=this._check.bind(this);this.onlineHandler=()=>this._handleStatusChange(!0);this.offlineHandler=()=>this._handleStatusChange(!1);this._connectionChangeSupported=!1;this._handleConnectionChange=this._handleConnectionChange.bind(this)}start(){window.addEventListener("online",this.onlineHandler);window.addEventListener("offline",this.offlineHandler);this._setupConnectionChangeListener();this._scheduleCheck()}stop(){window.removeEventListener("online",this.onlineHandler);window.removeEventListener("offline",this.offlineHandler);const e=this._getConnection();e&&this._connectionChangeSupported&&e.removeEventListener("change",this._handleConnectionChange);if(this._checkTimer){clearInterval(this._checkTimer);this._checkTimer=null}}async _check(){var e=window.performance.now();let t=navigator?.onLine??!1,n=null;if(this.pingUrl)try{const o=new AbortController;var i=setTimeout(()=>o.abort(),1e4);await fetch(this.pingUrl+"?_="+Date.now(),{method:"HEAD",mode:"no-cors",cache:"no-store",signal:o.signal,headers:{"X-Heartbeat":"true"}});clearTimeout(i);t=!0;n=window.performance.now()-e}catch{t=!1}i=t?"online":"offline",e=(i!==this._lastStatus?this._handleStatusChange(t):t?this.currentInterval=this.pollInterval:this.currentInterval=Math.min(this.currentInterval*this.backoffFactor,this.maxInterval),this._getConnectionInfo()),i=(this.onCheck({timestamp:Date.now(),interval:this.currentInterval,latency:n,status:i,connection:e}),e?.effectiveType??null);if(i!==this._lastEffectiveType){e=this._lastEffectiveType;this._lastEffectiveType=i;this.onChange({timestamp:Date.now(),effectiveType:i,previousEffectiveType:e,source:"poll"})}this._scheduleCheck()}_scheduleCheck(){this._checkTimer&&clearInterval(this._checkTimer);this._checkTimer=setTimeout(()=>this._check(),this.currentInterval)}_handleStatusChange(e){var t=Date.now();e?this.onOnline(t):this.onOffline(t);this.currentInterval=this.pollInterval;this._lastStatus=e?"online":"offline"}_setupConnectionChangeListener(){const e=this._getConnection();if(e&&"function"==typeof e.addEventListener){e.addEventListener("change",this._handleConnectionChange);this._connectionChangeSupported=!0;this._lastEffectiveType=e.effectiveType??null}else this._connectionChangeSupported=!1}_handleConnectionChange(){var e=this._getConnection();if(e){var t=e.effectiveType??null;if(t!==this._lastEffectiveType){var n=this._lastEffectiveType;this._lastEffectiveType=t;this.onChange({timestamp:Date.now(),effectiveType:t,previousEffectiveType:n,downlink:e.downlink??null,rtt:e.rtt??null,saveData:e.saveData??null,type:e.type??null})}}}_getConnectionInfo(){var e=this._getConnection();return void 0===e||null==e?null:{downlink:e.downlink??null,effectiveType:e.effectiveType??null,rtt:e.rtt??null,saveData:e.saveData??null,type:e.type??null}}_getConnection(){return navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection||null}}})();
